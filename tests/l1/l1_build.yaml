# Copyright (c) 2022 - 2023 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

apiVersion: image.openshift.io/v1
kind: ImageStream
metadata:
  name: l1_test
  namespace: intel-dgpu
spec: {}
---
apiVersion: build.openshift.io/v1
kind: BuildConfig
metadata:
  name: l1-test
  namespace: intel-dgpu
spec:
  runPolicy: "Serial"
  triggers:
    - type: "ConfigChange"
    - type: "ImageChange"
  source:
    type: Dockerfile
    dockerfile: |
          FROM golang:1.16.0 AS builder
          RUN git clone https://[git_username]:[Enter_Personal_Token_Here]@github.com/intel-sandbox/intel.dgpu.operator.prototype.git
          WORKDIR intel.dgpu.operator.prototype/tests/l1
          RUN make build
           
          FROM registry.access.redhat.com/ubi8-micro:latest
          RUN mkdir /iocp_test
          WORKDIR /iocp_test
          COPY --from=builder /go/intel.dgpu.operator.prototype/tests/l1/main /iocp_test/l1
          ENTRYPOINT ["/iocp_test/l1"]
  strategy:
    type: Docker
    noCache: true
  output:
    to:
      kind: ImageStreamTag
      name: l1_test:latest
